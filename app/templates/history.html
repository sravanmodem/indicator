<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signals History - NIFTY Options Indicator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        surface: {
                            700: '#1e293b',
                            800: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-slate-800 border-b border-slate-700">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/dashboard" class="text-2xl font-black">Options Indicator</a>
                    <span class="text-slate-400">|</span>
                    <h1 class="text-xl font-bold text-slate-300">Signals History</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/dashboard" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm font-semibold">Dashboard</a>
                    <a href="/settings" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm font-semibold">Settings</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Summary -->
    <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mb-8">
            <!-- Total Signals -->
            <div class="glass rounded-xl p-4">
                <p class="text-slate-400 text-xs font-semibold mb-1">Total Signals</p>
                <p class="text-3xl font-black text-white">{{ stats.total_signals }}</p>
            </div>

            <!-- Target Hit -->
            <div class="glass rounded-xl p-4 border border-green-500/30">
                <p class="text-slate-400 text-xs font-semibold mb-1">Target Hit</p>
                <p class="text-3xl font-black text-green-400">{{ stats.target_hit }}</p>
                <p class="text-green-400 text-xs mt-1">‚úÖ Winners</p>
            </div>

            <!-- Stop Loss Hit -->
            <div class="glass rounded-xl p-4 border border-red-500/30">
                <p class="text-slate-400 text-xs font-semibold mb-1">Stop Loss</p>
                <p class="text-3xl font-black text-red-400">{{ stats.stop_loss_hit }}</p>
                <p class="text-red-400 text-xs mt-1">üõë Losers</p>
            </div>

            <!-- Pending -->
            <div class="glass rounded-xl p-4 border border-amber-500/30">
                <p class="text-slate-400 text-xs font-semibold mb-1">Pending</p>
                <p class="text-3xl font-black text-amber-400">{{ stats.pending }}</p>
                <p class="text-amber-400 text-xs mt-1">‚è≥ Active</p>
            </div>

            <!-- Win Rate -->
            <div class="glass rounded-xl p-4 border border-blue-500/30">
                <p class="text-slate-400 text-xs font-semibold mb-1">Win Rate</p>
                <p class="text-3xl font-black text-blue-400">{{ stats.win_rate }}%</p>
                <p class="text-blue-400 text-xs mt-1">üìä Success</p>
            </div>

            <!-- Avg Quality -->
            <div class="glass rounded-xl p-4 border border-purple-500/30">
                <p class="text-slate-400 text-xs font-semibold mb-1">Avg Quality</p>
                <p class="text-3xl font-black text-purple-400">{{ stats.avg_quality_score }}</p>
                <p class="text-purple-400 text-xs mt-1">‚≠ê /100</p>
            </div>

            <!-- Total P&L -->
            <div class="glass rounded-xl p-4 border {% if stats.total_pnl >= 0 %}border-green-500/30{% else %}border-red-500/30{% endif %}">
                <p class="text-slate-400 text-xs font-semibold mb-1">Total P&L</p>
                <p class="text-3xl font-black {% if stats.total_pnl >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
                    {% if stats.total_pnl >= 0 %}+{% endif %}‚Çπ{{ "%.0f"|format(stats.total_pnl) }}
                </p>
                <p class="{% if stats.total_pnl >= 0 %}text-green-400{% else %}text-red-400{% endif %} text-xs mt-1">30 days</p>
            </div>
        </div>

        <!-- Filters -->
        <div class="glass rounded-xl p-4 mb-6" x-data="{ days: 7, result: 'all', index: 'all' }">
            <div class="flex flex-wrap items-center gap-4">
                <div>
                    <label class="text-slate-400 text-xs font-semibold mr-2">Period:</label>
                    <select
                        x-model="days"
                        @change="htmx.ajax('GET', '/htmx/history/signals?days=' + days + '&result=' + result + '&index=' + index, {target: '#signals-table', swap: 'innerHTML'})"
                        class="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm"
                    >
                        <option value="1">Today</option>
                        <option value="7" selected>Last 7 Days</option>
                        <option value="30">Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                    </select>
                </div>

                <div>
                    <label class="text-slate-400 text-xs font-semibold mr-2">Result:</label>
                    <select
                        x-model="result"
                        @change="htmx.ajax('GET', '/htmx/history/signals?days=' + days + '&result=' + result + '&index=' + index, {target: '#signals-table', swap: 'innerHTML'})"
                        class="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm"
                    >
                        <option value="all">All Results</option>
                        <option value="pending">Pending</option>
                        <option value="target_hit">Target Hit</option>
                        <option value="stop_loss_hit">Stop Loss Hit</option>
                    </select>
                </div>

                <div>
                    <label class="text-slate-400 text-xs font-semibold mr-2">Index:</label>
                    <select
                        x-model="index"
                        @change="htmx.ajax('GET', '/htmx/history/signals?days=' + days + '&result=' + result + '&index=' + index, {target: '#signals-table', swap: 'innerHTML'})"
                        class="px-3 py-2 rounded-lg bg-slate-800 border border-slate-700 text-white text-sm"
                    >
                        <option value="all">All Indices</option>
                        <option value="NIFTY">NIFTY</option>
                        <option value="BANKNIFTY">BANKNIFTY</option>
                        <option value="SENSEX">SENSEX</option>
                    </select>
                </div>

                <button
                    onclick="htmx.ajax('GET', '/htmx/history/signals?days=7&result=all&index=all', {target: '#signals-table', swap: 'innerHTML'})"
                    class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm font-semibold ml-auto"
                >
                    üîÑ Refresh
                </button>
            </div>
        </div>

        <!-- Signals Table -->
        <div
            id="signals-table"
            hx-get="/htmx/history/signals?days=7"
            hx-trigger="load"
            hx-swap="innerHTML"
            class="glass rounded-xl overflow-hidden"
        >
            <div class="p-8 text-center">
                <div class="w-16 h-16 mx-auto rounded-2xl bg-slate-700 flex items-center justify-center mb-4">
                    <svg class="w-8 h-8 text-slate-400 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                </div>
                <p class="text-slate-400">Loading signals...</p>
            </div>
        </div>
    </div>

    <script>
        // Auto-refresh every 30 seconds
        setInterval(() => {
            htmx.ajax('GET', '/htmx/history/signals?days=7', {target: '#signals-table', swap: 'innerHTML'});
        }, 30000);
    </script>
</body>
</html>
