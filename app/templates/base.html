<!DOCTYPE html>
<html lang="en" x-data="{ darkMode: true, sidebarOpen: true, sidebarCollapsed: false }"
      :class="{ 'dark': darkMode }" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Institutional-Grade Options Trading Platform">
    <title>{% block title %}Trading Terminal{% endblock %} | OptiFlow Pro</title>

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Enterprise Font Stack -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        // Enterprise Primary Palette
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                            950: '#1e1b4b',
                        },
                        // Trading Colors
                        bullish: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        },
                        bearish: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        },
                        // Neutral Dark Theme
                        surface: {
                            50: '#fafafa',
                            100: '#f4f4f5',
                            200: '#e4e4e7',
                            300: '#d4d4d8',
                            400: '#a1a1aa',
                            500: '#71717a',
                            600: '#52525b',
                            700: '#3f3f46',
                            800: '#27272a',
                            850: '#1f1f23',
                            900: '#18181b',
                            950: '#09090b',
                        },
                    },
                    spacing: {
                        '18': '4.5rem',
                        '88': '22rem',
                        '128': '32rem',
                    },
                    fontSize: {
                        '2xs': ['0.625rem', { lineHeight: '0.75rem' }],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'slide-down': 'slideDown 0.3s ease-out',
                        'scale-in': 'scaleIn 0.2s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideDown: {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        scaleIn: {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                    },
                    boxShadow: {
                        'glow-sm': '0 0 10px -3px rgba(99, 102, 241, 0.3)',
                        'glow': '0 0 20px -5px rgba(99, 102, 241, 0.4)',
                        'glow-lg': '0 0 30px -5px rgba(99, 102, 241, 0.5)',
                        'inner-glow': 'inset 0 1px 0 0 rgba(255, 255, 255, 0.05)',
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'grid-pattern': 'linear-gradient(to right, rgba(255,255,255,0.02) 1px, transparent 1px), linear-gradient(to bottom, rgba(255,255,255,0.02) 1px, transparent 1px)',
                    },
                },
            },
        }
    </script>

    <!-- Enterprise Design System Styles -->
    <style>
        /* Base Styles */
        * {
            scrollbar-width: thin;
            scrollbar-color: #3f3f46 #18181b;
        }

        *::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        *::-webkit-scrollbar-track {
            background: #18181b;
        }

        *::-webkit-scrollbar-thumb {
            background: #3f3f46;
            border-radius: 3px;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }

        /* Focus Ring */
        .focus-ring {
            @apply focus:outline-none focus:ring-2 focus:ring-primary-500/50 focus:ring-offset-2 focus:ring-offset-surface-900;
        }

        /* Card Variants */
        .card {
            @apply bg-surface-850 border border-surface-700/50 rounded-xl shadow-lg;
        }

        .card-elevated {
            @apply bg-surface-800 border border-surface-700/50 rounded-xl shadow-xl;
        }

        .card-interactive {
            @apply card hover:border-surface-600 hover:shadow-glow-sm transition-all duration-200 cursor-pointer;
        }

        /* Button Variants */
        .btn {
            @apply inline-flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200 focus-ring disabled:opacity-50 disabled:cursor-not-allowed;
        }

        .btn-primary {
            @apply btn bg-primary-600 text-white hover:bg-primary-500 active:bg-primary-700;
        }

        .btn-secondary {
            @apply btn bg-surface-700 text-surface-100 hover:bg-surface-600 active:bg-surface-800 border border-surface-600;
        }

        .btn-ghost {
            @apply btn text-surface-300 hover:text-white hover:bg-surface-700/50;
        }

        .btn-danger {
            @apply btn bg-bearish-600 text-white hover:bg-bearish-500 active:bg-bearish-700;
        }

        .btn-success {
            @apply btn bg-bullish-600 text-white hover:bg-bullish-500 active:bg-bullish-700;
        }

        /* Input Variants */
        .input {
            @apply w-full px-4 py-2.5 rounded-lg text-surface-100 placeholder-surface-500 focus:outline-none focus:ring-1 focus:ring-primary-500/50 transition-all duration-200;
            background-color: #09090b !important;
            border: 1px solid #3f3f46 !important;
            color: #f4f4f5 !important;
        }

        .input:focus {
            border-color: #6366f1 !important;
        }

        .input-sm {
            @apply w-full px-3 py-1.5 text-sm rounded-lg text-surface-100 placeholder-surface-500 focus:outline-none focus:ring-1 focus:ring-primary-500/50 transition-all duration-200;
            background-color: #09090b !important;
            border: 1px solid #3f3f46 !important;
            color: #f4f4f5 !important;
        }

        .input-sm:focus {
            border-color: #6366f1 !important;
        }

        /* All input types dark styling */
        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="password"],
        input[type="search"],
        input[type="tel"],
        input[type="url"],
        input[type="time"],
        input[type="date"],
        input[type="datetime-local"],
        textarea {
            background-color: #09090b !important;
            border-color: #3f3f46 !important;
            color: #f4f4f5 !important;
            color-scheme: dark;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="search"]:focus,
        input[type="tel"]:focus,
        input[type="url"]:focus,
        input[type="time"]:focus,
        input[type="date"]:focus,
        input[type="datetime-local"]:focus,
        textarea:focus {
            border-color: #6366f1 !important;
            outline: none !important;
        }

        /* Checkbox styling */
        input[type="checkbox"] {
            @apply appearance-none w-4 h-4 rounded border cursor-pointer;
            background-color: #18181b !important;
            border-color: #52525b !important;
        }

        input[type="checkbox"]:checked {
            background-color: #6366f1 !important;
            border-color: #6366f1 !important;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
            background-size: 100% 100%;
            background-position: center;
            background-repeat: no-repeat;
        }

        input[type="checkbox"]:focus {
            outline: none !important;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3) !important;
        }

        /* Select/Dropdown Styling */
        select,
        select.input,
        select.input-sm {
            @apply appearance-none cursor-pointer;
            background-color: #09090b !important;
            border: 1px solid #3f3f46 !important;
            color: #f4f4f5 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2371717a' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        select:focus,
        select.input:focus,
        select.input-sm:focus {
            border-color: #6366f1 !important;
            outline: none !important;
        }

        select option,
        select.input option,
        select.input-sm option {
            background-color: #18181b !important;
            color: #fafafa !important;
            padding: 0.5rem 1rem;
        }

        select option:hover,
        select option:checked {
            background-color: #3f3f46 !important;
        }

        /* Number input spinner buttons */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 0.5;
        }

        /* Time/Date picker styling */
        input[type="time"]::-webkit-calendar-picker-indicator,
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="datetime-local"]::-webkit-calendar-picker-indicator {
            filter: invert(0.7);
            cursor: pointer;
        }

        /* Badge Variants */
        .badge {
            @apply inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-md;
        }

        .badge-primary {
            @apply badge bg-primary-500/20 text-primary-300 border border-primary-500/30;
        }

        .badge-success {
            @apply badge bg-bullish-500/20 text-bullish-300 border border-bullish-500/30;
        }

        .badge-danger {
            @apply badge bg-bearish-500/20 text-bearish-300 border border-bearish-500/30;
        }

        .badge-warning {
            @apply badge bg-amber-500/20 text-amber-300 border border-amber-500/30;
        }

        .badge-neutral {
            @apply badge bg-surface-600/50 text-surface-300 border border-surface-600;
        }

        /* Trading Signal Colors */
        .signal-ce {
            @apply text-bullish-400;
        }

        .signal-pe {
            @apply text-bearish-400;
        }

        .signal-strong-ce {
            @apply text-bullish-300 font-semibold;
        }

        .signal-strong-pe {
            @apply text-bearish-300 font-semibold;
        }

        /* Data Display */
        .data-label {
            @apply text-xs font-medium text-surface-500 uppercase tracking-wider;
        }

        .data-value {
            @apply text-sm font-semibold text-surface-100;
        }

        .data-value-lg {
            @apply text-lg font-bold text-surface-50;
        }

        /* Price Display */
        .price-up {
            @apply text-bullish-400;
        }

        .price-down {
            @apply text-bearish-400;
        }

        .price-neutral {
            @apply text-surface-300;
        }

        /* Table Styles */
        .table-enterprise {
            @apply w-full text-sm;
        }

        .table-enterprise thead {
            @apply bg-surface-800/50 border-b border-surface-700;
        }

        .table-enterprise th {
            @apply px-4 py-3 text-left text-xs font-semibold text-surface-400 uppercase tracking-wider;
        }

        .table-enterprise tbody tr {
            @apply border-b border-surface-800 hover:bg-surface-800/30 transition-colors;
        }

        .table-enterprise td {
            @apply px-4 py-3 text-surface-200;
        }

        /* Skeleton Loading */
        .skeleton {
            @apply animate-pulse bg-surface-700/50 rounded;
        }

        /* Tooltip */
        .tooltip {
            @apply absolute z-50 px-2 py-1 text-xs font-medium text-white bg-surface-800 border border-surface-700 rounded-md shadow-lg whitespace-nowrap;
        }

        /* Grid Background Pattern */
        .grid-bg {
            background-size: 20px 20px;
            background-image:
                linear-gradient(to right, rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255,255,255,0.02) 1px, transparent 1px);
        }

        /* Gradient Accents */
        .gradient-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 50%, #818cf8 100%);
        }

        .gradient-bullish {
            background: linear-gradient(135deg, #047857 0%, #059669 50%, #10b981 100%);
        }

        .gradient-bearish {
            background: linear-gradient(135deg, #b91c1c 0%, #dc2626 50%, #ef4444 100%);
        }

        /* Glassmorphism */
        .glass {
            @apply bg-surface-900/80 backdrop-blur-xl border border-surface-700/50;
        }

        /* Status Indicators */
        .status-dot {
            @apply w-2 h-2 rounded-full;
        }

        .status-online {
            @apply status-dot bg-bullish-500 shadow-[0_0_8px_rgba(16,185,129,0.6)];
        }

        .status-offline {
            @apply status-dot bg-surface-500;
        }

        .status-warning {
            @apply status-dot bg-amber-500 shadow-[0_0_8px_rgba(245,158,11,0.6)];
        }

        .status-error {
            @apply status-dot bg-bearish-500 shadow-[0_0_8px_rgba(239,68,68,0.6)];
        }

        /* HTMX Loading States */
        .htmx-request .htmx-indicator {
            @apply opacity-100;
        }

        .htmx-indicator {
            @apply opacity-0 transition-opacity;
        }

        /* Transitions */
        .transition-panel {
            @apply transition-all duration-300 ease-in-out;
        }
    </style>

    {% block head %}{% endblock %}
</head>
<body class="bg-surface-950 text-surface-100 font-sans antialiased min-h-screen">
    <!-- Application Shell -->
    <div class="flex h-screen overflow-hidden">

        <!-- Sidebar Navigation -->
        <aside
            x-show="sidebarOpen"
            x-transition:enter="transition-panel"
            x-transition:enter-start="-translate-x-full"
            x-transition:enter-end="translate-x-0"
            x-transition:leave="transition-panel"
            x-transition:leave-start="translate-x-0"
            x-transition:leave-end="-translate-x-full"
            :class="sidebarCollapsed ? 'w-16' : 'w-64'"
            class="fixed lg:relative inset-y-0 left-0 z-40 flex flex-col bg-surface-900 border-r border-surface-800 transition-all duration-300"
        >
            <!-- Logo -->
            <div class="flex items-center h-16 px-4 border-b border-surface-800">
                <div class="flex items-center gap-3">
                    <div class="flex items-center justify-center w-9 h-9 rounded-lg gradient-primary">
                        <i data-lucide="activity" class="w-5 h-5 text-white"></i>
                    </div>
                    <span x-show="!sidebarCollapsed" class="text-lg font-bold text-white">OptiFlow</span>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
                <!-- Main Navigation -->
                <div class="mb-6">
                    <p x-show="!sidebarCollapsed" class="px-3 mb-2 text-xs font-semibold text-surface-500 uppercase tracking-wider">Main</p>

                    <a href="/dashboard" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/dashboard' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 text-surface-400 group-hover:text-primary-400"></i>
                        <span x-show="!sidebarCollapsed">Dashboard</span>
                    </a>

                    <a href="/terminal" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/terminal' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="monitor" class="w-5 h-5 text-surface-400 group-hover:text-primary-400"></i>
                        <span x-show="!sidebarCollapsed">Trading Terminal</span>
                    </a>
                </div>

                <!-- Trading Section -->
                <div class="mb-6">
                    <p x-show="!sidebarCollapsed" class="px-3 mb-2 text-xs font-semibold text-surface-500 uppercase tracking-wider">Markets</p>

                    <a href="/nifty" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/nifty' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="trending-up" class="w-5 h-5 text-bullish-400"></i>
                        <span x-show="!sidebarCollapsed">NIFTY 50</span>
                    </a>

                    <a href="/banknifty" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/banknifty' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="landmark" class="w-5 h-5 text-primary-400"></i>
                        <span x-show="!sidebarCollapsed">BANKNIFTY</span>
                    </a>

                    <a href="/sensex" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/sensex' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="bar-chart-3" class="w-5 h-5 text-amber-400"></i>
                        <span x-show="!sidebarCollapsed">SENSEX</span>
                    </a>
                </div>

                <!-- Analysis Section -->
                <div class="mb-6">
                    <p x-show="!sidebarCollapsed" class="px-3 mb-2 text-xs font-semibold text-surface-500 uppercase tracking-wider">Analysis</p>

                    <a href="/signals" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/signals' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="zap" class="w-5 h-5 text-surface-400 group-hover:text-primary-400"></i>
                        <span x-show="!sidebarCollapsed">Signals</span>
                    </a>

                    <a href="/option-chain" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/option-chain' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="table-2" class="w-5 h-5 text-surface-400 group-hover:text-primary-400"></i>
                        <span x-show="!sidebarCollapsed">Option Chain</span>
                    </a>

                    <a href="/history" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/history' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="history" class="w-5 h-5 text-surface-400 group-hover:text-primary-400"></i>
                        <span x-show="!sidebarCollapsed">History</span>
                    </a>
                </div>

                <!-- Trading Section -->
                <div class="mb-6">
                    <p x-show="!sidebarCollapsed" class="px-3 mb-2 text-xs font-semibold text-surface-500 uppercase tracking-wider">Trading</p>

                    <a href="/paper-trading" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/paper-trading' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="file-text" class="w-5 h-5 text-surface-400 group-hover:text-primary-400"></i>
                        <span x-show="!sidebarCollapsed">Paper Trading</span>
                    </a>

                    <a href="/auto-trade" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group {% if request.url.path == '/auto-trade' %}bg-surface-800 text-white{% endif %}">
                        <i data-lucide="bot" class="w-5 h-5 text-surface-400 group-hover:text-primary-400"></i>
                        <span x-show="!sidebarCollapsed">Auto Trading</span>
                    </a>
                </div>
            </nav>

            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-surface-800">
                <a href="/settings" class="flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg text-surface-300 hover:text-white hover:bg-surface-800 transition-colors group">
                    <i data-lucide="settings" class="w-5 h-5 text-surface-400 group-hover:text-primary-400"></i>
                    <span x-show="!sidebarCollapsed">Settings</span>
                </a>

                <!-- Collapse Toggle -->
                <button
                    @click="sidebarCollapsed = !sidebarCollapsed"
                    class="hidden lg:flex items-center gap-3 w-full px-3 py-2.5 mt-2 text-sm font-medium rounded-lg text-surface-400 hover:text-white hover:bg-surface-800 transition-colors"
                >
                    <i data-lucide="chevrons-left" class="w-5 h-5" :class="sidebarCollapsed && 'rotate-180'"></i>
                    <span x-show="!sidebarCollapsed">Collapse</span>
                </button>
            </div>
        </aside>

        <!-- Mobile Sidebar Overlay -->
        <div
            x-show="sidebarOpen"
            x-transition:enter="transition-opacity ease-out duration-300"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition-opacity ease-in duration-200"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            @click="sidebarOpen = false"
            class="fixed inset-0 z-30 bg-black/50 lg:hidden"
        ></div>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col overflow-hidden">

            <!-- Top Header Bar -->
            <header class="flex items-center justify-between h-16 px-4 lg:px-6 bg-surface-900/50 border-b border-surface-800 backdrop-blur-sm">
                <!-- Left Section -->
                <div class="flex items-center gap-4">
                    <!-- Mobile Menu Toggle -->
                    <button
                        @click="sidebarOpen = !sidebarOpen"
                        class="lg:hidden p-2 text-surface-400 hover:text-white rounded-lg hover:bg-surface-800 transition-colors"
                    >
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>

                    <!-- Page Title -->
                    <div>
                        <h1 class="text-lg font-semibold text-white">{% block page_title %}Dashboard{% endblock %}</h1>
                        <p class="text-xs text-surface-500">{% block page_subtitle %}Overview{% endblock %}</p>
                    </div>
                </div>

                <!-- Center Section - Market Status -->
                <div class="hidden md:flex items-center gap-6">
                    <!-- Market Status Component -->
                    <div id="market-status" hx-get="/htmx/market-status" hx-trigger="load, every 30s" class="flex items-center gap-4">
                        {% include 'partials/market_status.html' ignore missing %}
                    </div>
                </div>

                <!-- Right Section -->
                <div class="flex items-center gap-3">
                    <!-- Connection Status -->
                    <div id="connection-status" hx-get="/htmx/connection-status" hx-trigger="load, every 10s" class="flex items-center gap-2 px-3 py-1.5 bg-surface-800 rounded-lg">
                        <span class="status-dot status-offline" id="ws-status-dot"></span>
                        <span class="text-xs text-surface-400">Offline</span>
                    </div>

                    <!-- Theme Toggle -->
                    <button
                        @click="darkMode = !darkMode"
                        class="p-2 text-surface-400 hover:text-white rounded-lg hover:bg-surface-800 transition-colors"
                    >
                        <i x-show="darkMode" data-lucide="sun" class="w-5 h-5"></i>
                        <i x-show="!darkMode" data-lucide="moon" class="w-5 h-5"></i>
                    </button>

                    <!-- Notifications -->
                    <button class="relative p-2 text-surface-400 hover:text-white rounded-lg hover:bg-surface-800 transition-colors">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                        <span class="absolute top-1 right-1 w-2 h-2 bg-bearish-500 rounded-full"></span>
                    </button>

                    <!-- User Menu -->
                    <div x-data="{ open: false }" class="relative">
                        <button
                            @click="open = !open"
                            class="flex items-center gap-2 p-1.5 rounded-lg hover:bg-surface-800 transition-colors"
                        >
                            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-primary-500 to-primary-700 flex items-center justify-center">
                                <span class="text-sm font-semibold text-white">U</span>
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-surface-400"></i>
                        </button>

                        <!-- Dropdown -->
                        <div
                            x-show="open"
                            x-transition
                            @click.away="open = false"
                            class="absolute right-0 mt-2 w-48 py-2 bg-surface-800 border border-surface-700 rounded-xl shadow-xl z-50"
                        >
                            <div id="auth-status" hx-get="/htmx/auth-status" hx-trigger="load">
                                <a href="/auth/login" class="flex items-center gap-2 px-4 py-2 text-sm text-surface-300 hover:text-white hover:bg-surface-700">
                                    <i data-lucide="log-in" class="w-4 h-4"></i>
                                    Connect Broker
                                </a>
                            </div>
                            <hr class="my-2 border-surface-700">
                            <a href="/settings" class="flex items-center gap-2 px-4 py-2 text-sm text-surface-300 hover:text-white hover:bg-surface-700">
                                <i data-lucide="settings" class="w-4 h-4"></i>
                                Settings
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto bg-surface-950">
                <div class="p-4 lg:p-6">
                    {% block content %}{% endblock %}
                </div>
            </main>

            <!-- Footer -->
            <footer class="flex items-center justify-between px-6 py-3 bg-surface-900/50 border-t border-surface-800 text-xs text-surface-500">
                <span>OptiFlow Pro v2.0 | Institutional Trading Platform</span>
                <span id="server-time" hx-get="/htmx/server-time" hx-trigger="load, every 1s">--:--:--</span>
            </footer>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"></div>

    <!-- Initialize Lucide Icons -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

        // Reinitialize icons after HTMX swaps
        document.body.addEventListener('htmx:afterSwap', () => {
            lucide.createIcons();
        });

        // Toast notification function
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-bullish-600 border-bullish-500',
                error: 'bg-bearish-600 border-bearish-500',
                warning: 'bg-amber-600 border-amber-500',
                info: 'bg-primary-600 border-primary-500'
            };
            toast.className = `px-4 py-3 rounded-lg border shadow-lg text-white text-sm font-medium animate-slide-up ${colors[type]}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('opacity-0', 'transition-opacity');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>