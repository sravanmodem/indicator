<!-- Admin Active Signals Table -->
{% if error %}
<div class="p-4 text-center text-red-400">
    <p>Error loading signals: {{ error }}</p>
</div>
{% elif active_signals and active_signals|length > 0 %}
<table class="w-full">
    <thead>
        <tr class="text-left text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-surface-700 bg-surface-800/50">
            <th class="p-4">Signal</th>
            <th class="p-4">Symbol</th>
            <th class="p-4 text-right">Entry</th>
            <th class="p-4 text-right">Current</th>
            <th class="p-4 text-right">P&L</th>
            <th class="p-4 text-center">Users</th>
            <th class="p-4 text-center">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for signal in active_signals %}
        <tr class="border-b border-surface-700/30 hover:bg-surface-800/50">
            <td class="p-4">
                <div class="flex items-center gap-2">
                    <span class="px-2 py-1 rounded text-xs font-bold
                        {% if signal.index == 'NIFTY' %}bg-blue-500/20 text-blue-400
                        {% elif signal.index == 'BANKNIFTY' %}bg-purple-500/20 text-purple-400
                        {% else %}bg-green-500/20 text-green-400{% endif %}">
                        {{ signal.index }}
                    </span>
                    <span class="px-2 py-1 rounded text-xs font-bold
                        {% if signal.signal_type == 'CE' %}bg-green-500/20 text-green-400
                        {% else %}bg-red-500/20 text-red-400{% endif %}">
                        {{ signal.signal_type }}
                    </span>
                </div>
            </td>
            <td class="p-4">
                <p class="font-mono text-sm text-white">{{ signal.symbol }}</p>
                <p class="text-xs text-slate-500">{{ signal.strike }}</p>
            </td>
            <td class="p-4 text-right">
                <p class="font-mono font-bold text-white">Rs{{ "%.2f"|format(signal.entry_price) }}</p>
            </td>
            <td class="p-4 text-right">
                <p class="font-mono font-bold text-white">Rs{{ "%.2f"|format(signal.current_price or signal.entry_price) }}</p>
            </td>
            <td class="p-4 text-right">
                {% set pnl = (signal.current_price or signal.entry_price) - signal.entry_price %}
                <p class="font-mono font-bold {% if pnl >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
                    {% if pnl >= 0 %}+{% endif %}{{ "%.2f"|format(pnl) }}
                </p>
            </td>
            <td class="p-4 text-center">
                <span class="px-2 py-1 rounded text-xs font-bold bg-surface-700 text-slate-300">
                    {{ signal.execution_count or 0 }}
                </span>
            </td>
            <td class="p-4 text-center">
                <button
                    hx-post="/admin/signals/{{ signal.signal_id }}/close"
                    hx-vals='{"exit_price": {{ signal.current_price or signal.entry_price }}, "exit_reason": "Manual close"}'
                    hx-target="#active-signals-table"
                    hx-swap="innerHTML"
                    class="px-3 py-1 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500/30 text-xs font-bold transition-all">
                    Close
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="p-8 text-center">
    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-surface-700 flex items-center justify-center">
        <svg class="w-8 h-8 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
    </div>
    <h3 class="text-lg font-bold text-slate-400 mb-1">No Active Signals</h3>
    <p class="text-sm text-slate-500">Broadcast a signal to start trading</p>
</div>
{% endif %}
