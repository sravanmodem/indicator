{% if error %}
<div class="text-center py-4">
    <p class="text-red-400 text-sm">{{ error }}</p>
</div>
{% elif indicators %}
<div class="space-y-3">
    <!-- ATR -->
    <div class="bg-surface-800/50 rounded-xl p-4 border {% if indicators.atr.volatility_state.iloc[-1] == 'high' %}border-red-500/30{% elif indicators.atr.volatility_state.iloc[-1] == 'low' %}border-green-500/30{% else %}border-yellow-500/30{% endif %}">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-xl {% if indicators.atr.volatility_state.iloc[-1] == 'high' %}bg-red-500/20{% elif indicators.atr.volatility_state.iloc[-1] == 'low' %}bg-green-500/20{% else %}bg-yellow-500/20{% endif %} flex items-center justify-center">
                    <span class="font-bold text-xs {% if indicators.atr.volatility_state.iloc[-1] == 'high' %}text-red-400{% elif indicators.atr.volatility_state.iloc[-1] == 'low' %}text-green-400{% else %}text-yellow-400{% endif %}">ATR</span>
                </div>
                <div>
                    <p class="text-white font-bold">ATR (14)</p>
                    <p class="text-slate-400 text-xs">Average True Range</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-white font-mono font-bold text-lg">{{ "%.2f"|format(indicators.atr.atr.iloc[-1]) }}</p>
                <p class="{% if indicators.atr.volatility_state.iloc[-1] == 'high' %}text-red-400{% elif indicators.atr.volatility_state.iloc[-1] == 'low' %}text-green-400{% else %}text-yellow-400{% endif %} text-sm font-bold">
                    {{ indicators.atr.volatility_state.iloc[-1] | upper }} VOLATILITY
                </p>
            </div>
        </div>
        <div class="mt-3 grid grid-cols-2 gap-3">
            <div class="bg-surface-900/50 rounded-lg p-2 text-center">
                <p class="text-[10px] text-slate-500">ATR %</p>
                <p class="text-white font-mono font-bold text-sm">{{ "%.2f"|format(indicators.atr.atr_percent.iloc[-1]) }}%</p>
            </div>
            <div class="bg-surface-900/50 rounded-lg p-2 text-center">
                <p class="text-[10px] text-slate-500">Price Range</p>
                <p class="text-white font-mono font-bold text-sm">Â±{{ "%.0f"|format(indicators.atr.atr.iloc[-1]) }}</p>
            </div>
        </div>
    </div>

    <!-- Bollinger Bands -->
    {% if indicators.bollinger %}
    <div class="bg-surface-800/50 rounded-xl p-4 border border-blue-500/30">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center">
                    <span class="font-bold text-[9px] text-blue-400">BB</span>
                </div>
                <div>
                    <p class="text-white font-bold">Bollinger Bands</p>
                    <p class="text-slate-400 text-xs">20 Period, 2 StdDev</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-white font-mono font-bold text-lg">{{ "%.2f"|format(indicators.bollinger.middle.iloc[-1]) }}</p>
                <p class="text-blue-400 text-sm font-bold">MIDDLE BAND</p>
            </div>
        </div>
        <div class="mt-3 grid grid-cols-3 gap-3">
            <div class="bg-green-500/10 rounded-lg p-2 text-center border border-green-500/20">
                <p class="text-[10px] text-green-400">Upper</p>
                <p class="text-green-400 font-mono font-bold text-sm">{{ "%.2f"|format(indicators.bollinger.upper.iloc[-1]) }}</p>
            </div>
            <div class="bg-blue-500/10 rounded-lg p-2 text-center border border-blue-500/20">
                <p class="text-[10px] text-blue-400">Middle</p>
                <p class="text-blue-400 font-mono font-bold text-sm">{{ "%.2f"|format(indicators.bollinger.middle.iloc[-1]) }}</p>
            </div>
            <div class="bg-red-500/10 rounded-lg p-2 text-center border border-red-500/20">
                <p class="text-[10px] text-red-400">Lower</p>
                <p class="text-red-400 font-mono font-bold text-sm">{{ "%.2f"|format(indicators.bollinger.lower.iloc[-1]) }}</p>
            </div>
        </div>
        <div class="mt-3">
            <div class="flex items-center justify-between text-xs">
                <span class="text-slate-400">Band Width:</span>
                <span class="text-white font-mono">{{ "%.2f"|format(indicators.bollinger.bandwidth.iloc[-1]) }}%</span>
            </div>
            <div class="flex items-center justify-between text-xs mt-1">
                <span class="text-slate-400">Price Position:</span>
                {% set bb_position = ((price - indicators.bollinger.lower.iloc[-1]) / (indicators.bollinger.upper.iloc[-1] - indicators.bollinger.lower.iloc[-1]) * 100) %}
                <span class="{% if bb_position > 80 %}text-red-400{% elif bb_position < 20 %}text-green-400{% else %}text-white{% endif %} font-mono">
                    {% if bb_position > 80 %}Near Upper{% elif bb_position < 20 %}Near Lower{% else %}Middle{% endif %}
                </span>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% else %}
<div class="space-y-3">
    <div class="h-20 bg-surface-700 rounded-xl animate-pulse"></div>
    <div class="h-20 bg-surface-700 rounded-xl animate-pulse"></div>
</div>
{% endif %}
